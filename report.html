<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Laporan Keuangan</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 40px; }
    h1, h2 { text-align: center; }
    table { width: 100%; border-collapse: collapse; margin: 20px 0; }
    th, td { border: 1px solid #000; padding: 8px; text-align: left; }
    th { background: #f0f0f0; }
    .right { text-align: right; }
    @media print {
      button { display: none; }
    }
  </style>
</head>
<body>
  <h1>Laporan Keuangan Proyek</h1>
  <h2>Rupaloka Studio</h2>
  <p><strong>Nama Proyek:</strong> <span id="projectName"></span></p>
  <p><strong>Nama Konsumen:</strong> <span id="konsumen"></span></p>
  <p><strong>Nilai Proyek:</strong> Rp <span id="nilaiProyek">0</span></p>

  <h3>Pendapatan:</h3>
  <table>
    <tr><td>Pembayaran Termin</td><td class="right" id="pendapatan">0</td></tr>
    <tr><td>Lainnya</td><td class="right">0</td></tr>
    <tr><td><strong>Total Pendapatan</strong></td><td class="right"><strong id="totalPendapatan">0</strong></td></tr>
  </table>

  <h3>Pengeluaran:</h3>
  <table>
    <tr><td>Biaya Gaji</td><td class="right" id="gaji">0</td></tr>
    <tr><td>Biaya Material</td><td class="right" id="material">0</td></tr>
    <tr><td>Biaya Operasional</td><td class="right" id="operasional">0</td></tr>
    <tr><td>Biaya lain-lain</td><td class="right" id="lain">0</td></tr>
    <tr><td><strong>Total Pengeluaran</strong></td><td class="right"><strong id="totalPengeluaran">0</strong></td></tr>
  </table>

  <h3>Untung/Rugi: Rp <span id="untungRugi">0</span></h3>

  <button onclick="window.print()">Cetak PDF</button>
  <button onclick="window.close()">Tutup</button>

  <script src="js/firebase.js"></script>
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const projectId = urlParams.get('project');

    db.collection("projects").doc(projectId).get().then(doc => {
      if (doc.exists) {
        document.getElementById("projectName").textContent = doc.data().name;
        // Kamu bisa tambah field konsumen & nilai proyek di collection projects jika perlu
      }
    });

    let debet = 0, kredit = 0;
    db.collection("transactions")
      .where("projectId", "==", projectId)
      .get()
      .then(snapshot => {
        snapshot.forEach(doc => {
          const t = doc.data();
          if (t.type === "Debet") debet += t.amount;
          else kredit += t.amount;
        });

        // Asumsi sederhana: Debet = pendapatan, Kredit = pengeluaran
        document.getElementById("pendapatan").textContent = debet.toLocaleString('id-ID');
        document.getElementById("totalPendapatan").textContent = debet.toLocaleString('id-ID');

        // Pengeluaran contoh (bisa dikembangkan lebih detail)
        document.getElementById("gaji").textContent = "50.000.000";
        document.getElementById("material").textContent = "100.000.000";
        document.getElementById("operasional").textContent = "20.000.000";
        document.getElementById("lain").textContent = "10.000.000";
        const totalKeluar = 50e6 + 100e6 + 20e6 + 10e6;
        document.getElementById("totalPengeluaran").textContent = totalKeluar.toLocaleString('id-ID');

        const untung = debet - totalKeluar;
        document.getElementById("untungRugi").textContent = untung.toLocaleString('id-ID');
        document.getElementById("untungRugi").style.color = untung >= 0 ? "green" : "red";
      });
  </script>
</body>
</html>